<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="__ROOT__/static/kindeditor/themes/default/default.css" />
	<script charset="utf-8" src="__ROOT__/static/kindeditor/kindeditor-min.js"></script>
	<script charset="utf-8" src="__ROOT__/static/kindeditor/lang/zh_CN.js"></script>
	<link rel="stylesheet" type="text/css" href="__ROOT__/static/index/css/myneed/personal-body.css">
    <script charset="utf-8" src="__ROOT__/static/index/js/myneed/windowsOnscroll.js"></script>
    <link rel="stylesheet" href="__ROOT__/static/font-awesome/css/font-awesome.min.css">

    <!-- 裁剪图片 -->
    <link href="__ROOT__/static/imgCut/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="__ROOT__/static/imgCut/dist/cropper.min.css" rel="stylesheet">
    <link href="__ROOT__/static/imgCut/css/main2.css" rel="stylesheet">
	<title>{$title}</title>
	<style type="text/css">
	/*我的代养，我是代养人*/
	.pi_right{
		padding: 0;
		background: rgba(0,0,0,0);
	}
	.pi_right,.supplier{
		width: 790px;
	}
	.adoption{
		width: 790px;
		border-radius: 5px;
		border-bottom: 1px #eee solid;
	}
	.adoption ul{
		border: 0;
	}

	/*代养信息*/
	.sub_mesg{
		width: 100%;
		margin-top: 20px;
		background: #fff;
		border-radius: 5px;
	}
	.sub_title{
		width: 100%;
		height: 40px;
		line-height: 40px;
		text-indent: 2em;
		font-size: 12px;
		border-bottom: 1px #eee solid;
		position: relative;
	}
	.sub_title span{
		margin-left: 20px;
		color: #b9b0b0;
	}
	.sub_uploadmesg ul{
		width: 100%;
		position: relative;
	}
	.sub_uploadmesg ul li{
		float: left;
		list-style: none;
		padding: 20px;
		position: relative;
	}
	.label_number{
		width: 70px;
	    margin-top: 33px;
	    margin-left: 5px;
	    font-size: 12px;
	    color: #b9b0b0;
	    float: left;
	}
	#label_content_box{
		width: 100%;
		float: left;
		margin-bottom: 20px;
	}
	.label_content{
		float: left;
		max-width: 140px;
		margin-left: 20px;
		font-size: 12px;
		line-height: 30px;
		background: #eee;
		border-radius: 5px;
	}
	.label_content div{
		max-width: 140px;
		text-indent: 5px;
	}
	.label_content div i{
		width: 17px;
		height: 17px;
		font-size: 15px;
		color: #676767;
	}
	.label_content div i:hover{
		cursor: pointer;
	}
	.sub_uploadmesg ul li input{
		width: 600px;
		height: 40px;
		line-height: 40px;
		border-radius: 5px;
		text-indent: 2em;
		font-size: 12px;
		border: 1px #aaa solid;
		padding-right: 40px;
		outline: none;
		background: #eee;
	}
	.sub_uploadmesg ul li span{
		position: absolute;
		font-size: 12px;
		color: #aaa;
		top: 33px;
		right: 33px;
	}
	.sub_uploadmesg3{
		height: 190px;
	}
	</style>
</head>
<body>
	<div class="personal_information">
		<!-- 左侧 -->
		<div class="pi_left" id="pi_left">
			<!-- 头像 -->
			<div class="head_portrait">
				<div class="head_img">
					<img src="__ROOT__/{$userMesg.head_image_url}">
				</div>
				<div class="nick_name">{$userMesg.nick_name}</div>
			</div>
			<!-- 功能区 -->
			<div class="functional_area">
				<ul>
					<a href="__ROOT__/account"><li>资料与账号</li></a>
					<a href=""><li>我的收藏</li></a>
					<a href="__ROOT__/innerMsg/unread"><li>消息通知</li></a>
					<a href="__ROOT__/myadpotion/myadpotion"><li>订单消息</li></a>
					<a href="__ROOT__/publishdynamic"><li>我的动态</li></a>
					<a href="__ROOT__/substitutes/substitutes"><li class="choosed"><i></i>我是代养人</li></a>
					<a href="__ROOT__/supplier"><li>我是供应商</li></a>
				</ul>
			</div>
		</div>

		<!-- 右侧 -->
		<div class="pi_right">
			<!-- 资料与账号 -->
			<div class="supplier">
				<!-- 头按钮选择 -->
				<div class="supplier_function adoption" id="supplier_function">
					<ul>
						<a href="__ROOT__/substitutes/substitutes"><li>我的代养</li></a>
						<a href="__ROOT__/substitutes/newsubstitutes"><li class="selected"><i></i>发新代养</li></a>
						<!-- 用于清除浮动 -->
						<div style="clear: both;"></div>
					</ul>
				</div>
				<!-- 内容区 -->
				<div class="adpotion_box">
					<!-- 代养信息标题 -->
					<div class="sub_mesg">
						<div class="sub_title">代养信息标题</div>
						<div class="sub_uploadmesg sub_uploadmesg1">
							<ul>
								<li><input type="text" placeholder="请输入代养信息标题(最大长度为40个字符)"></input><span>0</span></li>
								<div style="clear: both;"></div>
							</ul>
						</div>
					</div>

					<!-- 初步报价 -->
					<div class="sub_mesg">
						<div class="sub_title">初步报价</div>
						<div class="sub_uploadmesg sub_uploadmesg5">
							<ul>
								<li><input style="width: 320px;" type="text" placeholder="请输入您的初步报价" value=""></input></li>
								<div style="clear: both;"></div>
							</ul>
						</div>
				    </div>

					<!-- 添加标签 -->
					<div class="sub_mesg">
						<div class="sub_title">添加标签<span>标签用于用户搜索</span></div>
						<div class="sub_uploadmesg sub_uploadmesg2">
							<ul>
								<li><input style="width: 320px;" type="text" placeholder="代养标签，空格或回车添加标签(每个最大长度为8个字符)"></input><span>0</span></li>
								<div class="label_number">添标签(<span id="label_number">4</span>)</div>
								<div id="label_content_box">
								</div>
								<div style="clear: both;"></div>
							</ul>
							<div></div>
						</div>
					</div>

					<!-- 上传封面 -->
					<div class="sub_mesg">
						<div class="sub_title">上传封面</div>
						<div class="sub_uploadmesg sub_uploadmesg3">
							<div class="" id="crop-avatar">
							    <!-- Current avatar -->
							    <div class="avatar-view" title="点击上传封面">
							      <img src="__ROOT__/static/imgCut/img/picture.jpg" alt="Avatar">
							    </div>

							    <!-- Cropping modal -->
							    <div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
							      <div class="modal-dialog modal-lg">
							        <div class="modal-content">
							          <form class="avatar-form" action="__ROOT__/static/imgCut/crop.php" enctype="multipart/form-data" method="post">
							            <div class="modal-header">
							              <button class="close" data-dismiss="modal" type="button">&times;</button>
							              <h4 class="modal-title" id="avatar-modal-label">上传封面</h4>
							            </div>
							            <div class="modal-body">
							              <div class="avatar-body">

							                <!-- Upload image and data -->
							                <div class="avatar-upload">
							                  <input class="avatar-src" name="avatar_src" type="hidden">
							                  <input class="avatar-data" name="avatar_data" type="hidden">
							                  <label for="avatarInput">本地上传</label>
							                  <input class="avatar-input" id="avatarInput" name="avatar_file" type="file">
							                </div>

							                <!-- Crop and preview -->
							                <div class="row">
							                  <div class="col-md-9">
							                    <div class="avatar-wrapper"></div>
							                  </div>
							                  <div class="col-md-3">
							                    <div class="avatar-preview preview-lg"></div>
							                    <div class="avatar-preview preview-md"></div>
							                    <div class="avatar-preview preview-sm"></div>
							                  </div>
							                </div>

							                <div class="row avatar-btns">
							                  <div class="col-md-9">
							                    <div class="btn-group">
							                      <button class="btn btn-primary" data-method="rotate" data-option="-90" type="button" title="Rotate -90 degrees">左旋转</button>
							                      <button class="btn btn-primary" data-method="rotate" data-option="-15" type="button">-15deg</button>
							                      <button class="btn btn-primary" data-method="rotate" data-option="-30" type="button">-30deg</button>
							                      <button class="btn btn-primary" data-method="rotate" data-option="-45" type="button">-45deg</button>
							                    </div>
							                    <div class="btn-group">
							                      <button class="btn btn-primary" data-method="rotate" data-option="90" type="button" title="Rotate 90 degrees">右旋转</button>
							                      <button class="btn btn-primary" data-method="rotate" data-option="15" type="button">15deg</button>
							                      <button class="btn btn-primary" data-method="rotate" data-option="30" type="button">30deg</button>
							                      <button class="btn btn-primary" data-method="rotate" data-option="45" type="button">45deg</button>
							                    </div>
							                  </div>
							                  <div class="col-md-3">
							                    <button class="btn btn-primary btn-block avatar-save" type="submit">确认</button>
							                  </div>
							                </div>
							              </div>
							            </div>
							            <!-- <div class="modal-footer">
							              <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
							            </div> -->
							          </form>
							        </div>
							      </div>
							    </div><!-- /.modal -->

							    <!-- Loading state -->
							    <div class="loading" aria-label="Loading" role="images" tabindex="-1"></div>
							  </div>
						</div>
					</div>

					<!-- 信息内容 -->
					<div class="sub_mesg">
						<div class="sub_title" id="textarea_sub_title">信息内容<span>图文结合效果更好</span></div>
						<div class="sub_uploadmesg sub_uploadmesg4">
							<form>
								<textarea name="content" style="width:788px;height:350px;"></textarea>
								<p style="font-size: 12px;height: 25px;line-height: 25px;text-align: right;">
									您当前输入了 <span class="word_count1">0</span> 个文符，还可以输入<span class="word_count2">2000</span>个字符
								</p>
							</form>
						</div>
					</div>

					<!-- 代养信息标题 -->
					<button id="release" type="button" style="width: 190px;height: 42px;margin-top: 20px;font-size: 14px;color: #444;background: #ffd100;border: 1px solid #ffd100;border-radius: 4px;cursor: pointer;text-align: center;outline: none;">发布</button>

				</div>
			</div>

		</div>
		<!-- 用于清除浮动 -->
		<div style="clear: both;"></div>
	</div>
	<script src="__ROOT__/static/imgCut/assets/js/jquery.min.js"></script>
    <script src="__ROOT__/static/imgCut/assets/js/bootstrap.min.js"></script>
    <script src="__ROOT__/static/imgCut/dist/cropper.min.js"></script>
    <script src="__ROOT__/static/imgCut/js/main2.js"></script>
	<script type="text/javascript">
		$(".actived").removeClass("actived");

		window.onscroll=function(){
            personalOnscroll();
        }

        // 标题文本框获得焦点
		$(".sub_uploadmesg1 ul li input").focus(function () {
			$(this).css("background","#fff");
			$(this).keyup(function () {
				var cont = $(this).val().length;
				$(this).next().text( cont );
				if (cont>40) {
					$(this).val ( readLeft($(this).val() , 40) );
				}
			});
		});
		$(".sub_uploadmesg1 ul li input").blur(function () {
			$(this).css("background","#eee");
			if ($(this).val().length == 0) {
				$(this).parent().parent().find('.warn').remove();
				$(this).parent().parent().append('<div class="warn" style="color: red;position: absolute;top: 30px; right: 60px;font-size: 15px;">'+'<i class="fa fa-warning"></i>'+'必填项'+'</div>');
			}else{
				$(this).parent().parent().find('.warn').remove();
			}
		});

		// 标签文本框获得焦点
		$(".sub_uploadmesg2 ul li input").focus(function () {
			$(this).css("background","#fff");
			// 统计字数
			$(this).keyup(function () {
				var cont = $(this).val().length;
				$(this).next().text( cont );
				if (cont>8) {
					$(this).val ( readLeft($(this).val() , 8) );
				}
			});
			// 回车键
			$(this).keydown(function(event){
				var inputleng = $(this).val().length;
				var label_number = $(this).parent().parent().find('#label_number').text();
				if ((event.keyCode == 32 || event.keyCode == 13) && label_number >0 && inputleng > 1) {
					labelContentBoxAdd( $(this).val() );
					$(this).val("");
					$(this).parent().parent().find('#label_number').text(label_number-1);
				}
			});
		});
		$(".sub_uploadmesg2 ul li input").blur(function () {
			$(this).val("");
			$(this).css("background","#eee");
			if ($(this).parent().parent().find('#label_number').text() == 4) {
				$(this).parent().parent().find('.warn').remove();
				$(this).parent().parent().append('<div class="warn" style="color: red;position: absolute;top: 30px; right: 60px;font-size: 15px;">'+'<i class="fa fa-warning"></i>'+'必填项'+'</div>');
			}else{
				$(this).parent().parent().find('.warn').remove();
			}
		});

		function labelContentBoxAdd(mystring) {
			$("#label_content_box").append('<div class="label_content">'+'<div title="'+mystring+'">'+mystring+'<i onclick="xClose(this)" class="fa fa-times"></i></div>'+'</div>');
		}


		function readLeft(mainStr,lngLen) {
			if (lngLen>0) {
				return mainStr.substring(0,lngLen)
			}else{
				return "";
			}
		}

		// 标签点击x
		function xClose(abj) {
			$(abj).parent().parent().remove();
			var number = $("#label_number").text();
			number = Number(number);
			$("#label_number").text( number+1 );
		}


		KindEditor.ready(function(K) {
			var editor = K.create('textarea[name="content"]', {
				afterChange : function() {
					K('.word_count1').html(this.count('text'));
					K('.word_count2').html(2000 - this.count('text'));
					if (this.count('text') <=0 ) {
						$("#textarea_sub_title").append('<div class="warn" style="color: red;position: absolute;top: 0; right: 60px;font-size: 15px;"><i class="fa fa-warning"></i>必填项</div>');
					}else{
						$("#textarea_sub_title").find('.warn').remove();
					}
					if (this.count('text') >= 2000) {
						editor.readonly();  
					}
				}
			});  
			K('#release').click(function(e) {
				release( editor.html() );
			});
		});


		// 点击发布
		function release(content) {
			// 获取标题
			var title = $(".sub_uploadmesg1").find("input").val();

			// 获取报价
			var quotes = $(".sub_uploadmesg5").find("input").val();
		
			// 获取标签
			var labelData = "";
			var labelArry = $("#label_content_box").find('.label_content');
			for (var i = labelArry.length - 1; i >= 0; i--) {
				labelData += $("#label_content_box .label_content:eq("+i+")").find('div').text() + ",";
			}

			// 获取封面数据
			var coverUrl = $(".avatar-view").data("coverUrl");
			// 获取信息内容

			if (title != "" && labelArry.length != 0 && typeof(coverUrl) != "undefined" && content != "" && quotes != "") {
				$.ajax({
				   type: "POST",
				   url: "__ROOT__/index/enter/newSubstitutes",
				   dataType: "json",
				   data: {"title":title,"coverUrl":coverUrl,"content":content,"labelData":labelData,"quotes":quotes},
				   success: function(msg){
				     if (msg == 1) {
				     	window.location.href="__ROOT__/substitutes/substitutes"; 
				     }
				   }
				});
			}else{
				alert("信息未填写完整！");
			}
		}
	</script>
</body>
</html>