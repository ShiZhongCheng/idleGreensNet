;(function(){'use strict';(function(){function a(a,b){b=b||{};var c=a.match(/\{\{(.*?)\}\}/g),d=a;if(c)for(var e=0;e<c.length;e++)var f=c[e],f=f.replace(/[\{\}]/g,""),d=d.replace(new RegExp("{{"+f+"}}","g"),b[f]||"");return d}MugineRequire("Utils/Browser");var b=MugineRequire("Render/StyleSheet");MugineRequire("Geom/Point");var c={},d={},e=null,f=function(){function e(){this.Sk={parent:null,left:0,top:0,width:320,height:240,zoom:1,data:null};this.yb=null}e.prototype={create:function(a){this.options={};for(var c in this.Sk)this.options[c]=
this.Sk[c];for(c in a)this.options[c]=a[c];a=this.options;c=document.createElement("div");var d=b.K("position:relative;");c.setAttribute("class",d);c.id="vr_container_"+a.id;if(a.parent){var d=a.width||getStyle(a.parent,"width",!0),e=a.height||getStyle(a.parent,"height",!0);c.style.width=d+"px";c.style.height=e+"px";a.parent.innerHTML="";a.parent.appendChild(c)}else d=a.width,e=a.height,c.style.width=d+"px",c.style.height=e+"px",c.style.position="absolute",c.style.top=a.top+"px",c.style.left=a.left+
"px",document.body.appendChild(c);this.update(a.data)},update:function(a){var b=this.options;a&&(b.data=a);this.aa()},aa:function(){var b=this.options,e=b.data||{},f=e.activeSceneId||"undefined",g="",n="",p=null;(e.scenes||[]).map(function(e){e.id==f&&(p=e.position);var g="";(e.hotspots||[]).map(function(e){var f=e.rawW,k=e.rawH,l=f>k?f/k:k/f,m=2<l,f={IC:e,type:m?"animation":"default",width:m?Math.min(f,k):f,height:m?Math.min(f,k):k,frames:Math.floor(l),ou:f,index:0};d[e.imageSrc]=f;f="";k=d[e.imageSrc];
l=void 0===e.size?32:e.size;l=0==l?1:l/Math.max(k.width,k.height);"animation"==k.type?(f+='frame="0" lastframe="'+(k.frames-1)+'" framewidth="'+k.width+'" frameheight="'+k.height+'" scale="'+l+'" crop="0|0|'+k.width+"|"+k.height+'" ',c[e.id]=JSON.clone(k)):f+='scale="'+l+'"';g+=a('<hotspot renderer="css3d" distorted="{{hotspot_distortion}}" capture="false" name="{{hotspot_name}}" keep="false" url="{{hotspot_url}}" ath="{{hotspot_ath}}" atv="{{hotspot_atv}}"  {{hotspot_extras}} onclick="js({{hotspot_click_callback}});" ondown="js({{hotspot_down_callback}});" onup="js({{hotspot_up_callback}});" onhover="js({{hotspot_hover_callback}});" onout="js({{hotspot_out_callback}});" visible="true" devices="html5.and.webgl.or.html5.and.css3d" />',
{hotspot_distortion:e.threeAni?"true":"false",hotspot_name:"hotspot_"+e.id,hotspot_ath:e.h,hotspot_atv:e.v,hotspot_url:e.imageSrc,hotspot_extras:f,hotspot_click_callback:"MugedaTools.onHotspotClicked("+b.id+","+e.id+")",hotspot_down_callback:"MugedaTools.onHotspotDown("+b.id+","+e.id+")",hotspot_up_callback:"MugedaTools.onHotspotUp("+b.id+","+e.id+")",hotspot_hover_callback:"MugedaTools.onHotspotHover("+b.id+","+e.id+")",hotspot_out_callback:"MugedaTools.onHotspotOut("+b.id+","+e.id+")"})});var k=
e.hfov||360,m="",m="";e.videoUrl?(m=a('<plugin name="video_{{video_id}}" url.html5="%$rawPluginPath%/videoplayer.js" videourl="{{video_url}}" />',{video_id:e.id,video_url:e.videoUrl}),m=m+'<image><sphere url="plugin:video_'+e.id+'" /></image>'):(m=e.cubeImage,m='<image type="'+(m?"CUBESTRIP":"SPHERE")+'" hfov="'+k+'" vfov="" voffset="0" prealign=""><'+(m?"cubestrip":"sphere")+' url="'+e[m?"cubeImage":"sphereImage"]+'" />'+(m?'<left strip="1"  /><front strip="2" /><right strip="3" /><back strip="4"  /><up strip="5"  /><down strip="6"  />':
"")+"</image>");n+=a('<scene name="{{scene_name}}" title="{{scene_title}}" onstart="" thumburl="{{scene_thumb}}" lat="{{scene_lat}}" lng="{{scene_lng}}" heading="0.0"><preview url="{{scene_preview}}" />{{scene_image}}{{scene_hotspots}}</scene>',{scene_name:"scene_"+e.id,scene_title:e.name,scene_thumb:e.thumb||e.sphereImage,scene_lat:"",scene_lng:"",scene_ath:(e.position||{}).h,scene_atv:(e.position||{}).v,scene_fov:"",scene_fovmin:"",scene_fovmax:"",scene_preview:e.preview,scene_image:m,scene_hotspots:g})});
var g=a('<krpano version="1.19" title="">{{vr_skin}}<skin_settings maps="false" maps_type="google" maps_bing_api_key="" maps_zoombuttons="false" gyro="{{vr_gyro}}" webvr="{{vr_stereo}}" littleplanetintro="false" title="true" thumbs="true" thumbs_width="64" thumbs_height="64" thumbs_padding="10" thumbs_crop="" thumbs_opened="false"  thumbs_text="true"  thumbs_dragging="true"  thumbs_onhoverscrolling="false"  thumbs_scrollbuttons="false"  thumbs_scrollindicator="false"  thumbs_loop="false"  tooltips_buttons="false"  tooltips_thumbs="false"  tooltips_hotspots="false"  tooltips_mapspots="false"  deeplinking="false"  loadscene_flags="MERGE"  loadscene_blend="BLEND(0.5)"  loadscene_blend_prev="SLIDEBLEND(0.5, 180, 0.75, linear)"  loadscene_blend_next="SLIDEBLEND(0.5, 0, 0.75, linear)"  loadingtext="\u6b63\u5728\u52a0\u8f7d..."  layout_width="100%"  layout_maxwidth="814"  controlbar_width="-24"  controlbar_height="40"  controlbar_offset="20"  controlbar_offset_closed="-40"  controlbar_overlap.no-fractionalscaling="10"  controlbar_overlap.fractionalscaling="0"  design_skin_images="vtourskin.png"  design_bgcolor="0x000000"  design_bgalpha="0.5"  design_bgborder="0"  design_bgroundedge="1"  design_bgshadow="0 4 10 0x000000 0.3"  design_thumbborder_bgborder="3 0xFFFFFF 1.0"  design_thumbborder_padding="2"  design_thumbborder_bgroundedge="0"  design_text_css="color:#FFFFFF; font-family:Arial;"  design_text_shadow="1" /><action name="startup" autorun="onstart"> set(startscene,{{scene_start_id}}); if(startscene === null OR !scene[get(startscene)], copy(startscene,scene[0].name); ); if(startscene !== null, loadscene(get(startscene), null, MERGE)); if(startactions !== null, startactions() ); </action>{{vr_scenes}}</krpano>',
{scene_start_id:"scene_"+f,vr_scenes:n,vr_gyro:1,vr_stereo:e.stereo,vr_skin:e.showBar||1==e.gyroOn?'<include url="%$skinPath%/vtourskin.xml" />':""}),q="vr_panorama_"+b.id;document.getElementById(q)&&removepano(q);var r={};r.onstart="loadxml('"+g+"')";p&&(r.onloaded="lookto("+p.h+","+p.v+",90,smooth())");g=e.pluginPath||"";embedpano({xml:"",target:"vr_container_"+b.id,id:q,html5:"prefer",initvars:{skinPath:e.skinPath,rawPluginPath:g,pluginPath:"/"==g[0]?g:"../../"+g},vars:r});this.yb=document.getElementById(q);
this.yb.className="vr_panorama";p&&this.yb&&(this.yb.call("lookto("+p.h+","+p.v+")"),1==e.gyroOn&&(this.yb.call("switch(plugin[skin_gyro].enabled)"),e.showBar||this.yb.call("set(layer[skin_layer].visible,false)")),isMobile()&&this.yb.call("tween(view.fov, 105, 0.6, easeInOutSine"))},D:function(a){var b=this;if(b.yb){var c=a.param||{};a=c.scene_name;var c="hotspot_"+c.hotspot_name,d=b.yb.get("hotspot["+c+"].ath"),e=b.yb.get("hotspot["+c+"].atv"),c=b.yb.get("xml.scene");if(a&&"undefined"!==a){var f=
"scene_"+a;if(f!=c){a=b.yb.get("mouse.x");var c=b.yb.get("mouse.y"),g=b.yb.get("view.fov");a=b.yb.screentosphere(a,c);b.yb.call("lookto("+a.x+","+a.y+","+.6*g+");");setTimeout(function(){b.yb.call("loadscene("+f+", null, MERGE, BLEND(0.5));");b.yb.call("set(view.fov,"+g+")");b.yb.call("lookto("+d+","+e+");")},800)}else b.yb.call("lookto("+d+","+e+");")}else b.yb.call("lookto("+d+","+e+");")}}};return e}();(window.MugedaTools=window.MugedaTools||{}).renderVR=function(a){a=a||{};var b=new f;b.create=
b.create;b.update=b.update;b.render=b.aa;b.doAction=b.D;b.create({id:a.id,parent:a.parent||null,width:a.width,height:a.height,zoom:a.zoom,data:a.data});e||(e=setInterval(function(){if(b.yb)for(var a in c){var d=c[a],e=d.index,f=Math.floor(e/d.ou);b.yb.call("set(hotspot[hotspot_"+a+"].crop,"+(e-f*d.ou)*d.width+"|"+f*d.height+"|"+d.width+"|"+d.height+");");d.index++;d.index==d.frames&&(d.index=0)}},40));return b}})();var Um=window.MugineRequire,Vm=Um("Utils/Module"),Wm=Um("Utils/Plugin"),Xm=Um("Display/Shape"),Ym=Um("Utils/mugedaAPIAObject");function Zm(){Zm.f.constructor.apply(this,arguments);this.cj=null}Vm.extend(Zm,Xm);var $m=Zm.prototype;$m.I="VR";$m.nA=function(){return this.cj};$m.Qi=function(a,b){this.A.param[a]=b};$m.ti=function(a){return this.A.param[a]};$m.jh=function(a){if("draw"==a)return this.cj};
$m.or=function(a){var b=this;a=a||b.A;((a.param.vrData||{}).scenes||[]).map(function(a){(a.hotspots||[]).map(function(a){try{b.Yj["vr_hotspot_"+a.id]={Fz:JSON.parse(a.behavior||"[]"),Ue:[]}}catch(c){}})})};Zm.Xb=function(a){function b(c){b.f.constructor.apply(this,arguments);c&&c.vb(this);this.A=a}Vm.extend(b,Zm);return b};
Zm.$g=function(){function a(c,d){a.f.constructor.apply(this,arguments);Vm.ob(this,["h",b.j]);Vm.ob(this,["v",b.B])}Vm.extend(a,Ym);var b=a.prototype;b.j=function(){return this.dom.querySelector(".vr_panorama")?this.dom.querySelector(".vr_panorama").get("view.hlookat"):null};b.B=function(){return this.dom.querySelector(".vr_panorama")?this.dom.querySelector(".vr_panorama").get("view.vlookat"):null};return a};Vm.H("Display.VR",Zm);Wm.ld(2046,Zm);var an=window.MugineRequire,bn=an("Utils/Module"),cn=an("Render/RenderObject"),dn=an("Render/RenderObjectShape"),en=an("Render/StyleSheet"),fn=an("Utils/Plugin"),gn=an("Utils/Browser");an("Events/InputEvent");function hn(){hn.f.constructor.apply(this,arguments)}bn.extend(hn,dn);var jn=hn.prototype;
jn.va=function(){this.constructor.f.va.apply(this,arguments);var a=this.S.lastIndexOf("</div>"),a=0<a?this.S.substr(0,a):this.S,b=en.K("position: absolute; display: block; left: 0px;top: 0px;right: 0px;bottom: 0px;background: transparent;");en.K("vr_panorama center","visibility:hidden;");this.S=a=a+('<div class="vr_holder '+b+'"></div>')+"</div>"};
function kn(a){this.identifier=a.identifier;this.target=a.target;this.clientX=a.clientX;this.clientY=a.clientY;this.screenX=a.screenX;this.screenY=a.screenY;this.pageX=a.pageX;this.pageY=a.pageY}function ln(){var a=[];a.item=function(a){return this[a]||null};a.j=function(a){return this[a+1]||null};return a}function mn(a){var b=new ln;b.push(new kn(a));return b}
function nn(a){a=a||{};var b={target:null,type:"touchstart",Iz:!0,cancelable:!0,view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,el:0,fl:0,hl:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,touches:0,targetTouches:0,changedTouches:0,scale:0,rotation:0,pD:0,Vk:1,identifier:0},c;for(c in b)b.hasOwnProperty(c)&&(b[c]=void 0!==a[c]?a[c]:b[c]);a=/iPhone|iP[oa]d/.test(navigator.userAgent)?"iOS":/Android/.test(navigator.userAgent)?"Android":"PC";window.TouchEvent.length&&window.Touch.length?(a=
new Touch({identifier:b.identifier,target:b.target,clientX:b.clientX,clientY:b.clientY,screenX:b.screenX,screenY:b.screenY,pageX:b.clientX,pageY:b.clientY,el:b.el,fl:b.fl,hl:b.hl,Vk:b.Vk}),a=new TouchEvent(b.type,{cancelable:!0,bubbles:!0,touches:[a],targetTouches:[a],changedTouches:[a]})):"Android"===a||"iOS"===a?(a=document.createEvent("Event"),a.initEvent(b.type,!0,!0),a.altKey=!1,a.ctrlKey=!1,a.metaKey=!1,a.shiftKey=!1,a.touches=mn(b),a.targetTouches=mn(b),a.changedTouches=mn(b)):(a=document.createEvent("TouchEvent"),
a.initTouchEvent(b.type,b.Iz,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.touches,b.targetTouches,b.changedTouches,b.scale,b.rotation));return a}
jn.aa=function(a,b,c){function d(a){var b=("mousedown"==a.type||"mouseup"==a.type)&&!on,c=a[a.type+"MugedaHooked"],d=q?a.changedTouches[0]:null,f=0,g=0;c||a.type!=gn.Hc||(f=(d||a).clientX-m.x,g=(d||a).clientY-m.y);var f="mousemove"==a.type&&l&&(0!=f||0!=g),h=null;if(!(b||f||c)){if(q||!l){b=a.target;try{h=b.parentElement.parentElement.id=="vr_panorama_"+e.l?b.parentElement:null}catch(k){}}if(h||!q&&on)a.stopImmediatePropagation(),a.preventDefault(),b=e.La(),n=b.C.T.wc(),p=b.C.T.xc(),a.type==gn.Db&&
(m.x=(d||a).clientX,m.y=(d||a).clientY),c=(d||a).clientX/n,f=(d||a).clientY/p,q||!h||h.Qt||(h.Qt=h.getBoundingClientRect,h.getBoundingClientRect=function(){var a=h.Qt();return a={left:a.left/n,top:a.top/p,right:a.right/n,bottom:a.bottom/p,width:a.width/n,height:a.height/p}}),b=a.target,q?d=nn({target:b,type:a.type,screenX:c,screenY:f,clientX:c,clientY:f,el:d.el,fl:d.fl,hl:d.hl,Vk:d.Vk,identifier:d.identifier}):(d=document.createEvent("MouseEvents"),d.initMouseEvent(a.type,!0,!0,window,1,c,f,c,f,!1,
!1,!1,!1,0,null)),d[a.type+"MugedaHooked"]=!0,b.dispatchEvent(d)}}var e=this.c;this.constructor.f.aa.apply(this,arguments);var f=this.P.querySelector(".vr_holder"),g=this.P.querySelector("#vr_panorama_"+e.l),h=e.A.param,k=h.vrData||{},l=!1,m={},n=1,p=1,q="touchstart"==gn.Db;window.addEventListener(gn.Db,function(a){l=!0;d(a)},!0);window.addEventListener(gn.qb,function(a){l=!1;d(a)},!0);window.addEventListener(gn.Hc,function(a){d(a)},!0);f&&!g&&(g=e.La(),n=g.C.T.wc(),p=g.C.T.xc(),g=Math.max(n,p),e.cj=
pn.renderVR({parent:f,width:h.width,height:h.height,id:e.l,data:k,zoom:g,isMobile:q}),e.De&&e.De.If("ready",{object:e.cj}))};var on=!1,pn=window.MugedaTools=window.MugedaTools||{};pn.onHotspotClicked=function(a,b){var c=a.replace("vr_panorama_","");((cn.gf[c].c.Yj||{})["vr_hotspot_"+b]||{}).Ue.forEach(function(a){a.D()})};pn.onHotspotDown=function(){};pn.onHotspotUp=function(){};pn.onHotspotHover=function(){on=!0};pn.onHotspotOut=function(){on=!1};fn.md(2046,hn);
})();